<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Anatomy API Test</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", Arial, sans-serif; padding: 20px; }
    input, textarea, button { font-size: 16px; padding: 10px; width: 100%; box-sizing: border-box; margin: 8px 0; }
    textarea { min-height: 120px; }
    button { cursor: pointer; }
    pre { background: #f6f8fa; padding: 12px; overflow: auto; }
    .row { max-width: 760px; margin: 0 auto; }
    .label { margin-top: 12px; font-weight: 600; }
  </style>
</head>

<body>
  <div class="row">
    <h2>ğŸ”‘ æ¸¬è©¦ Worker â†’ Anthropic</h2>

    <div class="label">Worker URL</div>
    <input id="url" value="https://anatomy-api.ougaga26.workers.dev/" />

    <div class="label">å¯†ç¢¼ï¼ˆCORRECT_PASSWORDï¼‰</div>
    <input id="password" placeholder="è¼¸å…¥ Quorra2026" />

    <div class="label">Model</div>
    <input id="model" value="claude-sonnet-4-5-20250929" />

    <div class="label">ä½ è¦å•ä»€éº¼</div>
    <textarea id="prompt">Hello! How can I help you today?</textarea>

    <button id="send">é€å‡ºæ¸¬è©¦</button>

    <div class="label">çµæœï¼ˆåŸå§‹ JSON / éŒ¯èª¤ï¼‰</div>
    <pre id="raw"></pre>

    <div class="label">Claude å›è¦†æ–‡å­—ï¼ˆå¦‚æœæœ‰ï¼‰</div>
    <pre id="text"></pre>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    $("send").addEventListener("click", async () => {
      const url = $("url").value.trim();
      const password = $("password").value.trim();
      const model = $("model").value.trim();
      const prompt = $("prompt").value;

      $("raw").textContent = "";
      $("text").textContent = "";

      if (!url) return alert("è«‹å¡« Worker URL");
      if (!password) return alert("è«‹å¡«å¯†ç¢¼");

      const payload = {
        // âœ… Body ä¹Ÿå¸¶å¯†ç¢¼ï¼ˆé¿å…è¼ªè¿´ï¼‰
        password,
        model,
        max_tokens: 200,
        messages: [{ role: "user", content: prompt }]
      };

      try {
        const res = await fetch(url, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            // âœ… Header ä¹Ÿå¸¶å¯†ç¢¼ï¼ˆé¿å…è¼ªè¿´ï¼‰
            "X-Password": password
          },
          body: JSON.stringify(payload)
        });

        const text = await res.text(); // å…ˆè®€æ–‡å­—ï¼Œé¿å… JSON parse éŒ¯åˆè®Š [object Object]
        $("raw").textContent = `HTTP ${res.status}\n\n${text}`;

        // å˜—è©¦ parse JSONï¼ˆæˆåŠŸæ‰æŠ½ Claude textï¼‰
        let data = null;
        try { data = JSON.parse(text); } catch {}

        if (!res.ok) {
          // âœ… é¡¯ç¤ºå¯è®€éŒ¯èª¤
          const msg =
            data?.error?.message ||
            (typeof data?.error === "string" ? data.error : null) ||
            data?.message ||
            "è«‹çœ‹ä¸‹æ–¹ raw";

          alert(`éŒ¯èª¤ï¼š${msg}`);
          return;
        }

        // Anthropic messages API: content[0].text
        const reply = data?.content?.[0]?.text;
        $("text").textContent = reply ? reply : "(æ²’æœ‰è§£æåˆ° content[0].textï¼Œä½† raw æœ‰å®Œæ•´è³‡æ–™)";

      } catch (err) {
        alert("ç™¼ç”Ÿä¾‹å¤–ï¼š" + (err?.message || String(err)));
      }
    });
  </script>
</body>
</html>
